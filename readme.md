## Установка:

1. Клонируйте репозиторий и смените ветку на master:

```
https://github.com/ElizaSwanson/Skyhabit-tracker
```
2. Создайте и заполните данными файл <b>.env</b> по шаблону <b>.env.sample</b>, который находится в корне проекта
3. Создайте и примените миграции

```
python manage.py makemigrations
python manage.py migrate
```

4. Если необходимо, загрузите следующие фикстуры:

```
   python manage.py loaddata user_fixture.json --format json
   python manage.py loaddata habit_fixture.json --format json
```
5. Если необходимо, создайте суперпользователя. Введите команду и следуйте инструкциям:

```
python manage.py createsuperuser
```

## Запуск в контейнере:

### Зависимости:
- Docker (должен быть установлен и запущен Docker Desktop)
- Docker Compose
### Установка:

1. Клонируйте репозиторий:
```
https://github.com/ElizaSwanson/Skyhabit-tracker
```
2. Создайте и заполните данными файл <b>.env</b> по шаблону <b>.env.sample</b>
3. Соберите и запустите контейнеры
```
docker-compose up --build
```
4. Примените миграции. Откройте новый терминал (или командную строку) и выполните:
```
docker-compose exec web python manage.py migrate
```
Теперь проект должен быть доступен по адресу http://localhost:8000/
Документацию по работе с api можно изучить по адресу: http://localhost:8000/redoc/
Для остановки контейнера выполните:
```
docker-compose down
```
Эта команда остановит и удалит контейнеры, но не удалит образы.
## Деплой на удаленный сервер

### Настройка удаленного сервера

1. **Подготовка сервера**:
   - Убедитесь, что ваш сервер запущен на базе Ubuntu (или другой Linux-дистрибутив).
   - Установите [Docker](https://docs.docker.com/engine/install/) и [Docker Compose](https://docs.docker.com/compose/install/) на удаленном сервере
2. **Клонирование репозитория на сервере**:
   - Подключитесь к удаленному серверу через SSH и выполните:
```
     https://github.com/ElizaSwanson/SkyDRFhomeworks
```    

4. **Создание файла `.env` на сервере**:
   - Скопируйте или создайте файл `.env` на сервере, заполнив его необходимыми переменными окружения. Для этого нужно перейти в новую директорию через команду cd и выполнить:
```
     nano .env
```
### Деплой приложения:

1. **Сборка и запуск контейнеров**:
ВНИМАНИЕ!!! В ОТЛИЧИЕ ОТ СТАРЫХ ВЕРСИЙ, В НОВЫХ СБОРКАХ КОМАНДЫ DOCKER ДОЛЖНЫ ВВОДИТЬСЯ БЕЗ ДЕФИСА!!!
```
   docker compose up --build -d
```

2. **Примените миграции**:
```
   docker compose exec web python manage.py migrate
```  

3. **Создание суперпользователя (опционально)**:
```
   docker compose exec web python manage.py createsuperuser
```  

Теперь ваше приложение должно быть доступно по IP-адресу вашего сервера.

### HOTKEYS:

- **Для просмотра логов всех сервисов в реальном времени**:
```
    docker-compose logs -f
```
    
  
- **Проверьте статус ваших контейнеров**:
```
    docker-compose ps
```

# CI/CD Pipeline
Проект использует GitHub Actions для автоматизации процессов:
- Линтинг
- Тестирование
- Сборка Docker-образа
- Деплой на сервер

## Этапы выполнения:
### Линтинг (Lint)
- Запускается при каждом push и pull request
- Использует Python 3.12
- Устанавливает Poetry с виртуальным окружением в проекте
- Кеширует зависимости
- Проверяет код с помощью flake8

### Тестирование (Test)
- Зависит от успешного линтинга
- Устанавливает все зависимости проекта
- Выполняет миграции базы данных
- Запускает юнит-тесты Django

### Сборка (Build)
- Зависит от успешного тестирования
- Собирает Docker-образ с тегом, содержащим хеш коммита
- Пушит образ в Docker Hub

### Деплой (Deploy)
- Зависит от успешной сборки
- Подключается к серверу по SSH
- Останавливает текущий контейнер
- Запускает новый контейнер из свежего образа

## Требования к окружению
### Секреты GitHub (добавить в Settings → Secrets):
- DOCKER_HUB_USERNAME - логин Docker Hub
- DOCKER_HUB_ACCESS_TOKEN - токен доступа Docker Hub
- SSH_KEY - приватный SSH-ключ для доступа к серверу
- SSH_USER - пользователь сервера
- SERVER_IP - IP-адрес сервера
- DEPLOY_DIR - директория для деплоя

### Сервер:
- Установленный Docker
- Разрешенный SSH-доступ
- Открытый 80 порт (для веб-доступа)

### ip: 89.169.171.82



